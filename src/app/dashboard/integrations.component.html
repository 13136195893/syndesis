<ipaas-loading [loading]="loading">
  <div class="container-cards-pf ipaas-dashboard-integrations">

    <!-- First Row: Page Header & Toolbar -->

    <div class="row row-cards-pf first-row vertical-align">
      <div class="page-header col-xs-12">
        <div class="col-xs-8">
          <h1>Dashboard: Integrations</h1>
        </div>
        <div class="col-xs-4 actions">
          <div class="pull-right">
            <a href="#" [routerLink]="['/integrations']">View All Integrations</a>&nbsp;&nbsp;
            <button class="btn btn-primary" [routerLink]="['/integrations/create']">Create Integration</button>
          </div>
        </div>
      </div>
    </div>


    <!-- Second Row -->

    <div class="row row-cards-pf second-row">

      <!-- Left: Integrations -->

      <div class="col-xs-7 top-integrations">
        <div class="card-pf">
          <div class="card-pf-heading">
            <p class="card-pf-heading-details">Last 30 days</p>

            <h2 class="card-pf-title">
              Top 5 Integrations
            </h2>
          </div>
          <div class="card-pf-body">
            <div class="row"
                 *ngFor="let integration of integrations; let i=index">

              <div class="col-xs-12 integration"
                   *ngIf="i<5">
                <!-- Icons -->

                <div class="col-xs-3 icons"
                     (click)="selectedIntegration(integration)">
                  <div class="list-view-pf-left">
                    <span [class]="'fa ' + getStartIcon(integration) + ' list-view-pf-icon-sm'"></span>
                    <span class="fa fa-angle-right"></span>
                    <span [class]="'fa ' + getFinishIcon(integration) + ' list-view-pf-icon-sm'"></span>
                  </div>
                </div>

                <!-- Name -->

                <div class="col-xs-4 name"
                     (click)="selectedIntegration(integration)">
                  {{ integration.name }}
                </div>

                <!-- Times of Use -->

                <div class="col-xs-3 times-of-use"
                     (click)="selectedIntegration(integration)">
                  <p>{{ integration.timesUsed || 0 }} uses
                  </p>
                </div>

                <!-- Status -->

                <div class="col-xs-1 status"
                     (click)="selectedIntegration(integration)">

                  <!-- OK Status -->

                  <i *ngIf="!integration.statusMessage"
                     class="pficon pficon-ok"></i>

                  <!-- Not OK Status -->

                  <template #statTemplate>{{integration.statusMessage}}</template>
                  <i *ngIf="integration.statusMessage"
                     class="pficon pficon-error-circle-o"
                     [tooltip]="statTemplate"
                     placement="bottom"></i>
                </div>


                <!-- Actions -->
                <div class="col-xs-1 actions">
                  <div class="dropdown pull-right dropdown-kebab-pf">
                    <button class="btn btn-link dropdown-toggle"
                            type="button"
                            id="dropdownKebabRight9"
                            data-toggle="dropdown"
                            aria-haspopup="true"
                            aria-expanded="true">
                      <span class="fa fa-ellipsis-v"></span>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-right"
                        aria-labelledby="dropdownKebabRight9">
                      <li>
                        <a [routerLink]=" ['/integrations/edit', integration.id, 'save-or-add-step'] ">Edit</a>
                      </li>
                      <li>
                        <a (click)="requestDeactivate(integration)">Deactivate</a>
                      </li>
                      <li *ngIf="integration.active === false"
                          (click)="requestActivate(integration)">
                        <a>Activate</a>
                      </li>
                      <!--
                      <li>
                        <a>Duplicate</a>
                      </li>
                      -->
                      <li>
                        <a (click)="requestDelete(integration)">Delete</a>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>

            </div>
          </div>
        </div>
      </div>


      <!-- Right -->

      <div class="col-xs-5">

        <!-- Right: Integration Board -->

        <div class="card-pf integration-board">
          <div class="card-pf-heading">
            <h2 class="card-pf-title">
              Integration Board
            </h2>
          </div>
          <div class="card-pf-body">
            <div class="col-xs-8 chart"
                 *ngIf="!loading">
              <canvas baseChart
                      [data]="doughnutChartData"
                      [labels]="doughnutChartLabels"
                      [chartType]="doughnutChartType"
                      [colors]="doughnutChartColors"
                      [legend]="doughnutChartLegend"
                      [options]="doughnutChartOptions"
                      (chartHover)="chartHovered($event)"
                      (chartClick)="chartClicked($event)"></canvas>
              <div class="total-count">
                <div class="number">{{ integrations.length }}</div>
                <div class="text">integrations</div>
              </div>
            </div>
            <div class="col-xs-4 legend">
              <div class="col-xs-12">
                <div class="col-xs-1 colors active"></div>
                <div class="col-xs-10 text">Active: {{ countActiveIntegrations() || 0 }}</div>
              </div>
              <div class="col-xs-12">
                <div class="col-xs-1 colors deleted"></div>
                <div class="col-xs-10 text">Deleted: {{ countDeletedIntegrations() || 0 }}</div>
              </div>
              <div class="col-xs-12">
                <div class="col-xs-1 colors draft"></div>
                <div class="col-xs-10 text">Drafts: {{ countDraftIntegrations() || 0 }}</div>
              </div>
              <div class="col-xs-12">
                <div class="col-xs-1 colors inactive"></div>
                <div class="col-xs-10 text">Inactive: {{ countInactiveIntegrations() || 0 }}</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Right: Recent Updates -->

        <div class="card-pf recent-updates">
          <div class="card-pf-heading">
            <h2 class="card-pf-title">
              Recent Updates
            </h2>
          </div>
          <div class="card-pf-body">
            <div class="row"
                 *ngFor="let integration of integrations; let i=index">
              <div class="update col-xs-12"
                   *ngIf="i<5"
                   (click)="selectedIntegration(integration)">
                <div class="col-xs-5">
                  Updated: <a [routerLink]=" ['/integrations/edit', integration.id, 'save-or-add-step'] ">
                  {{ integration.name }}
                </a>
                </div>
                <div class="col-xs-4">
                <span [class]="'label ' + getLabelClass(integration)">
                  {{ integration.desiredStatus }}
                </span>
                </div>
                <div class="col-xs-3">
                  {{ integration.lastUpdated | date:'d MMM HH:MM' }}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>


    <!-- Third Row: Connections Header & Toolbar -->

    <div class="row row-cards-pf third-row vertical-align">
      <div class="page-header col-xs-12">
        <div class="col-xs-8">
          <h1>Dashboard: Connections</h1>
        </div>
        <div class="col-xs-4 actions">
          <div class="pull-right">
            <a href="#" [routerLink]="['/connections']">View All Connections</a>&nbsp;&nbsp;
            <button class="btn btn-primary" [routerLink]="['/connections/create']">Create Connection</button>
          </div>
        </div>
      </div>
    </div>


    <!-- Fourth Row: Connections -->

    <div class="row row-cards-pf fourth-row">

      <ipaas-dashboard-connections [connections]="connections | async"
                                   [loading]="loading"
                                   (selectedConnection)="selectedConnection($event)"></ipaas-dashboard-connections>

    </div>
  </div>
</ipaas-loading>
