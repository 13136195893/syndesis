<ipaas-loading [loading]="loading">
  <div class="integrations list">

    <!-- Toast Notification Container -->

    <toaster-container></toaster-container>

    <!-- Modal Container -->

    <div bsModal
         #childModal="bs-modal"
         class="modal fade"
         tabindex="-1"
         role="dialog"
         aria-labelledby="activateModal"
         aria-hidden="true">
      <div class="modal-dialog modal-md">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title pull-left">Confirm {{ getActionTitle() }}</h4>
            <button type="button"
                    class="close pull-right"
                    aria-label="Close"
                    (click)="hideModal()">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <div>
              <p>Are you sure you would like to {{ getAction() }} the following integration?</p>
            </div>
            <div style="text-align: center; font-weight: 700">
              <p>{{ selectedIntegration?.name }}</p>
            </div>
          </div>
          <div class="modal-footer">
            <button class="pull-right btn btn-primary"
                    (click)="doAction(currentAction, selectedIntegration)">
              {{ getActionButtonText() }}
            </button>
            <button class="pull-right btn btn-cancel"
                    (click)="hideModal()">Cancel
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="integration col-xs-12"
         *ngFor="let integration of integrations; let i=index">

      <!-- Group 1: Icons -->

      <div class="col-xs-2 group icons">
        <div class="col-xs-12"
             (click)="goto(integration)">
          <div class="list-view-pf-left"
               *ngIf="integration">
            <span class="card-pf-icon-large image-icon"
                  *ngIf="getStart(integration).connection">
                  <img src="../../../assets/icons/{{ getStart(integration).connection.connectorId }}.integration.png">
                </span>
            <span class="fa fa-angle-right"></span>
            <span class="card-pf-icon-large image-icon"
                  *ngIf="getFinish(integration).connection">
                  <img src="../../../assets/icons/{{ getFinish(integration).connection.connectorId }}.integration.png">
                </span>
          </div>
        </div>
      </div>

      <!-- Group 2: Text -->

      <div class="col-xs-6 group text">

        <!-- Name -->
        <div class="col-xs-4 name"
             (click)="goto(integration)">
          {{ integration.name }}
        </div>

        <!-- Description -->
        <div class="col-xs-8 description"
             (click)="goto(integration)">
          <div class="list-group-item-text">
            {{ integration.description }}
          </div>
        </div>
      </div>

      <!-- Group 3: Metrics & Actions -->

      <div class="col-xs-4 group metrics-actions">

        <!-- Active/Inactive Labels -->

        <div class="col-xs-5 active-inactive">
          <div class="list-view-pf-additional-info-item">

            <!-- In Progress -->
            <!--
                <div *ngIf="(integration.currentStatus !== integration.desiredStatus) && !integration.statusMessage">
                  <div class="spinner spinner-sm spinner-inline"></div>
                </div>
                -->
            <div class="in-progress">
              <h3>
                <div class="spinner spinner-sm spinner-inline"></div>
                In Progress
              </h3>
            </div>

            <div *ngIf="integration.currentStatus === integration.desiredStatus">
              <span *ngIf="integration.currentStatus === 'Activated'"
                    class="label label-success"
                    [tooltip]="statTemplate"
                    (click)="requestDeactivate(integration)">Active</span>
              <span *ngIf="integration.currentStatus === 'Deactivated'"
                    class="label label-default"
                    [tooltip]="statTemplate"
                    (click)="requestActivate(integration)">Inactive</span>
              <span *ngIf="integration.currentStatus === 'Draft'"
                    class="label label-primary"
                    [tooltip]="statTemplate"
                    disabled>Draft</span>
              <span *ngIf="integration.currentStatus === 'Deleted'"
                    class="label label-danger"
                    [tooltip]="statTemplate"
                    disabled>Deleted</span>
            </div>
          </div>
        </div>


        <!-- Metrics & Actions -->

        <div class="col-xs-7">

          <!-- Uses -->

          <div class="col-xs-7 uses">
            <p>{{ integration.timesUsed || 0 }} uses</p>
          </div>


          <!-- Pass/Fail -->

          <div class="col-xs-4 pass-fail">

            <!-- OK Status -->

            <i *ngIf="!integration.statusMessage"
               class="pficon pficon-ok"></i>

            <!-- Not OK Status -->

            <template #statTemplate>{{integration.statusMessage}}</template>
            <i *ngIf="integration.statusMessage"
               class="pficon pficon-error-circle-o"
               [tooltip]="statTemplate"
               placement="bottom"
               container="body"></i>
          </div>


          <!-- Actions -->

          <div class="col-xs-1 actions">
            <div dropdown
                 class="dropdown pull-right dropdown-kebab-pf">
              <button dropdownToggle
                      class="btn btn-link"
                      type="button"
                      id="dropdownKebabRight9"
                      data-toggle="dropdown"
                      aria-haspopup="true"
                      aria-expanded="true">
                    <span class="fa fa-ellipsis-v"></span>
                  </button>
              <ul dropdownMenu
                  class="dropdown-menu dropdown-menu-right"
                  aria-labelledby="dropdownKebabRight9">
                <li role="menuitem">
                  <a [routerLink]="['edit', integration.id, 'save-or-add-step']">Edit</a>
                </li>
                <li role="menuitem"
                    *ngIf="integration.desiredStatus === 'Activated'">
                  <a (click)="requestDeactivate(integration)">Deactivate</a>
                </li>
                <li role="menuitem"
                    *ngIf="integration.desiredStatus === 'Deactivated'">
                  <a (click)="requestActivate(integration)">Activate</a>
                </li>
                <li role="menuitem"
                    *ngIf="integration.active === false"
                    (click)="requestActivate(integration)">
                  <a>Activate</a>
                </li>
                <!--
                    <li>
                      <a>Duplicate</a>
                    </li>
                    -->
                <li role="menuitem">
                  <a (click)="requestDelete(integration)">Delete</a>
                </li>
              </ul>
            </div>
          </div>

        </div>

      </div>

    </div>
  </div>
</ipaas-loading>
